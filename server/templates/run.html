{{template "header.html" .}}
	<script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.min.js"></script>
	<h2>Run: {{.Name}}</h2>
	<p>UUID: {{.UUID}}</p>
	{{if .Parameters}}
	<h2>Parameters</h2>
	<table border="1" cellpadding="5" cellspacing="0">
		<thead>
			<tr>
				<th>Key</th>
				<th>Value</th>
				<th>Type</th>
			</tr>
		</thead>
		<tbody>
		{{range .Parameters}}
			<tr>
				<td>{{.Key}}</td>
				<td>{{.Value}}</td>
				<td>{{.Type}}</td>
			</tr>
		{{end}}
		</tbody>
	</table>
	{{end}}
	<h2>Metrics</h2>
	<table border="1" cellpadding="5" cellspacing="0">
		<thead>
			<tr>
				<th>Key</th>
				<th>Chart</th>
				<th>Values</th>
			</tr>
		</thead>
		<tbody>
		{{range $idx, $metric := .Metrics}}
			<tr>
				<td>{{$metric.Key}}</td>
				<td>
					<canvas id="chart-{{$idx}}" width="200" height="70"></canvas>
				</td>
				<td>
					{{range $i, $v := $metric.Values}}{{if lt $i 3}}{{if $i}}, {{end}}{{$v.Value}}{{end}}{{end}}{{if gt (len $metric.Values) 3}}...{{end}}
				</td>
			</tr>
		{{end}}
		</tbody>
	</table>
	<script>
		// Metric data from server
		const metricData = [
			{{range $idx, $metric := .Metrics}}
			{
				labels: [{{range $i, $v := $metric.Values}}{{if $i}}, {{end}}{{if $v.Step}}{{$v.Step}}{{else}}{{$v.Time}}{{end}}{{end}}],
				values: [{{range $i, $v := $metric.Values}}{{if $i}}, {{end}}{{$v.Value}}{{end}}]
			},
			{{end}}
		];

		// Create sparkline charts for each metric
		for (let i = 0; i < metricData.length; i++) {
			const ctx = document.getElementById('chart-' + i).getContext('2d');
			const data = metricData[i];

			new Chart(ctx, {
				type: 'line',
				data: {
					labels: data.labels,
					datasets: [{
						data: data.values,
						borderColor: '#0066cc',
						borderWidth: 1.5,
						pointRadius: 0,
						fill: false,
						tension: 0.1
					}]
				},
				options: {
					responsive: false,
					maintainAspectRatio: false,
					plugins: {
						legend: { display: false },
						tooltip: { enabled: false }
					},
					scales: {
						x: {
							display: true,
							ticks: {
								font: { size: 8 },
								maxTicksLimit: 5
							},
							grid: { display: false }
						},
						y: {
							display: true,
							ticks: {
								font: { size: 8 },
								maxTicksLimit: 4
							},
							grid: { color: '#f0f0f0' }
						}
					}
				}
			});
		}
	</script>
</body>
</html>
